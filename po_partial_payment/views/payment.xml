<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="view_account_payment_form_reconcile" model="ir.ui.view">
        <field name="name">Payment Reconcile</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="action_reconcile_lines" type="object" class="oe_stat_button" string="Reconcile" attrs="{'invisible': [('state', '!=', 'posted')]}"/>
            </xpath>

            <xpath expr="//group[last()]" position="after">
                <notebook>
                        <page string="Reconcile" >
                            <field name="partial_lines" context="{'default_partner_id': partner_id}">
                                <tree editable="bottom" >
                                    <field name="payment_id" invisible="1"/>
                                    <field name="reconciled_id" invisible="1"/>
                                    <field name="partner_id" invisible="1"/>
                                    <field name="move_id" option="{'no_create': True, 'no_edit': True}" attrs="{'readonly': [('reconciled_id', '!=', False)]}" options="{'no_create': True, 'no_create_edit': True}"/>
                                    <field name="move_amt" force_save="1" />
                                    <field name="residual_amount" force_save="1"/>
                                    <field name="amount" attrs="{'readonly': [('reconciled_id', '!=', False)]}" sum="Total Amount"/>
                                    <button name="button_undo_reconciliation" type="object" attrs="{'invisible': [('reconciled_id', '=', False)]}" string="Revert reconciliation" icon="fa-undo"/>
                                </tree>
                            </field>
                        </page>
                </notebook>
            </xpath>
        </field>
    </record>

</odoo>